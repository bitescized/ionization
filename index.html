<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Ionization Energy Simulation</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            background-color: white;
        }
        
        #root {
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            // State for the simulation
            const [selectedElement, setSelectedElement] = useState(null);
            const [activeDragIndex, setActiveDragIndex] = useState(null);
            const [dragPosition, setDragPosition] = useState({ x: 0, y: 0 });
            const [dragStartPosition, setDragStartPosition] = useState({ x: 0, y: 0 });
            const [completedIonizations, setCompletedIonizations] = useState([]);
            const [ionizationDetails, setIonizationDetails] = useState([]);
            const [energyValue, setEnergyValue] = useState(0);
            const [maxEnergy, setMaxEnergy] = useState(3000);
            const [isDragging, setIsDragging] = useState(false);
            const [resetKey, setResetKey] = useState(0);
            const [electrons, setElectrons] = useState([]);
            const [allowInnerShellRemoval, setAllowInnerShellRemoval] = useState(true);
            const [shellElectronCounts, setShellElectronCounts] = useState({});
            const [currentDraggedShell, setCurrentDraggedShell] = useState(null);

            // Canvas ref for electron animation
            const canvasRef = useRef(null);
            const animationFrameRef = useRef(null);

            // Define consistent colors for each shell type
            const shellColors = {
                "Inner Shell": ["#4caf50", "#a5d6a7"], // Green for inner shell
                "Middle Shell": ["#7b1fa2", "#ab47bc"], // Purple for middle shell
                "Outer Shell": ["#1976d2", "#42a5f5"], // Blue for outer shell
            };

            // Enhanced element data with shell-specific ionization energies
            const elements = {
                Li: {
                    name: "Lithium",
                    atomicNumber: 3,
                    color: "#900C3F",
                    shellConfiguration: [2, 1],
                    shellIonizationEnergies: {
                        0: [7298, 11815], // Inner shell (1s) - first and second electron
                        1: [520], // Outer shell (2s) - one electron
                    },
                    sequentialIonizationEnergies: [520, 7298, 11815],
                },
                Be: {
                    name: "Beryllium",
                    atomicNumber: 4,
                    color: "#C70039",
                    shellConfiguration: [2, 2],
                    shellIonizationEnergies: {
                        0: [14848, 21006], // Inner shell (1s) - first and second electron
                        1: [899, 1757], // Outer shell (2s) - first and second electron
                    },
                    sequentialIonizationEnergies: [899, 1757, 14848, 21006],
                },
                Na: {
                    name: "Sodium",
                    atomicNumber: 11,
                    color: "#FFC300",
                    shellConfiguration: [2, 8, 1],
                    shellIonizationEnergies: {
                        0: [141362, 159075], // Inner shell (1s) - first and second electron
                        1: [13354, 16613, 20117, 25496, 28932], // Middle shell (2s, 2p) - 8 electrons
                        2: [496], // Outer shell (3s) - one electron
                    },
                    sequentialIonizationEnergies: [
                        496, 4562, 6910, 9543, 13354, 16613, 20117, 25496, 28932, 141362, 159075,
                    ],
                },
                Mg: {
                    name: "Magnesium",
                    atomicNumber: 12,
                    color: "#FF5733",
                    shellConfiguration: [2, 8, 2],
                    shellIonizationEnergies: {
                        0: [169988, 189368], // Inner shell (1s) - first and second electron
                        1: [13630, 17995, 21703, 25661, 31653, 35458], // Middle shell (2s, 2p) - 8 electrons
                        2: [738, 1451], // Outer shell (3s) - two electrons
                    },
                    sequentialIonizationEnergies: [
                        738, 1451, 7733, 10540, 13630, 17995, 21703, 25661, 31653, 35458, 169988, 189368,
                    ],
                },
                H: {
                    name: "Hydrogen",
                    atomicNumber: 1,
                    color: "#C0C0C0", // Silver
                    shellConfiguration: [1],
                    shellIonizationEnergies: {
                        0: [1312], // Single electron in 1s
                    },
                    sequentialIonizationEnergies: [1312],
                },
                He: {
                    name: "Helium",
                    atomicNumber: 2,
                    color: "#D9FFFF", // Light cyan
                    shellConfiguration: [2],
                    shellIonizationEnergies: {
                        0: [2372, 5250], // Two electrons in 1s
                    },
                    sequentialIonizationEnergies: [2372, 5250],
                },
                O: {
                    name: "Oxygen",
                    atomicNumber: 8,
                    color: "#FF0000", // Red
                    shellConfiguration: [2, 6],
                    shellIonizationEnergies: {
                        0: [32826, 47261], // Inner shell (1s)
                        1: [1314, 3388, 5301, 7469, 10990, 13326], // Outer shell (2s, 2p)
                    },
                    sequentialIonizationEnergies: [
                        1314, 3388, 5301, 7469, 10990, 13326, 32826, 47261,
                    ],
                },
                F: {
                    name: "Fluorine",
                    atomicNumber: 9,
                    color: "#90E050", // Yellow-green
                    shellConfiguration: [2, 7],
                    shellIonizationEnergies: {
                        0: [37830, 53780], // Inner shell (1s)
                        1: [1681, 3374, 6050, 8408, 11023, 15164, 17868], // Outer shell (2s, 2p)
                    },
                    sequentialIonizationEnergies: [
                        1681, 3374, 6050, 8408, 11023, 15164, 17868, 37830, 53780,
                    ],
                },
                Ne: {
                    name: "Neon",
                    atomicNumber: 10,
                    color: "#B3E3F5", // Light blue
                    shellConfiguration: [2, 8],
                    shellIonizationEnergies: {
                        0: [44400, 63500], // Inner shell (1s)
                        1: [2081, 3952, 6122, 9371, 12177, 15238, 19999, 23069], // Outer shell (2s, 2p)
                    },
                    sequentialIonizationEnergies: [
                        2081, 3952, 6122, 9371, 12177, 15238, 19999, 23069, 44400, 63500,
                    ],
                },
                Al: {
                    name: "Aluminum",
                    atomicNumber: 13,
                    color: "#BFA6A6", // Gray-brown
                    shellConfiguration: [2, 8, 3],
                    shellIonizationEnergies: {
                        0: [198310, 224950], // Inner shell (1s)
                        1: [18828, 23780, 28790, 33900, 39610, 47100, 56290, 63500], // Middle shell (2s, 2p)
                        2: [578, 1817, 2745], // Outer shell (3s, 3p)
                    },
                    sequentialIonizationEnergies: [
                        578, 1817, 2745, 11580, 14830, 18380, 23330, 27460, 31850, 38470, 42640, 201400, 222300,
                    ],
                },
                Cl: {
                    name: "Chlorine",
                    atomicNumber: 17,
                    color: "#1FF01F", // Bright green
                    shellConfiguration: [2, 8, 7],
                    shellIonizationEnergies: {
                        0: [299010, 329950], // Inner shell (1s)
                        1: [31930, 38430, 45850, 54100, 62700, 72450, 88750, 97920], // Middle shell (2s, 2p)
                        2: [1251, 2298, 3822, 5158, 6542, 9362, 11018], // Outer shell (3s, 3p)
                    },
                    sequentialIonizationEnergies: [
                        1251, 2298, 3822, 5158, 6542, 9362, 11018, 23810, 29900, 36000, 43200, 51400, 60400, 70400, 81800, 93400, 352000,
                    ],
                },
                Ar: {
                    name: "Argon",
                    atomicNumber: 18,
                    color: "#80D1E3", // Light teal
                    shellConfiguration: [2, 8, 8],
                    shellIonizationEnergies: {
                        0: [326300, 358200], // Inner shell (1s)
                        1: [34800, 41600, 49600, 58400, 67600, 77800, 91000, 100800], // Middle shell (2s, 2p)
                        2: [1520, 2666, 3931, 5771, 7238, 8781, 11995, 13842], // Outer shell (3s, 3p)
                    },
                    sequentialIonizationEnergies: [
                        1520, 2666, 3931, 5771, 7238, 8781, 11995, 13842, 40760, 46190, 52500, 59400, 71700, 75000, 88600, 103400, 111700, 386200,
                    ],
                },
                S: {
                    name: "Sulfur",
                    atomicNumber: 16,
                    color: "#FFFF30", // Bright yellow
                    shellConfiguration: [2, 8, 6],
                    shellIonizationEnergies: {
                        0: [32826, 47261], // Inner shell (1s)
                        1: [2252, 2673, 3361, 4564, 7013, 8496, 27107, 31669], // Middle shell (2s, 2p)
                        2: [1000, 2252, 3357, 4556, 7004, 8495], // Outer shell (3s, 3p)
                    },
                    sequentialIonizationEnergies: [
                        1000, 2252, 3357, 4556, 7004, 8495, 27107, 31669, 72594, 88049, 108100, 128558, 164934, 200000, 230766, 284766,
                    ],
                },
                Rb: {
                    name: "Rubidium",
                    atomicNumber: 37,
                    color: "#702EB0", // Purple
                    shellConfiguration: [2, 8, 18, 8, 1],
                    shellIonizationEnergies: {
                        0: [684600, 750600], // Inner shell (1s)
                        1: [93200, 106900, 122100, 138900, 157100, 177500, 200200, 225500], // Second shell (2s, 2p)
                        2: [15200, 16500, 18100, 19900, 22000, 24400, 27100, 30100, 33500, 37200, 41300, 45800, 50800, 56300, 62400, 69000, 76100, 83900], // Third shell (3s, 3p, 3d)
                        3: [2633, 4857, 6910, 9543, 13354, 16613, 20117, 25496], // Fourth shell (4s, 4p)
                        4: [403], // Outer shell (5s)
                    },
                    sequentialIonizationEnergies: [
                        403, 2633, 3859, 5080, 6850, 8140, 9570, 13120, 14500, 26740, 28700, 30940, 33410, 36170, 39240, 42640, 46400, 50530, 55060, 60000, 65370, 71200, 77520, 84360, 91750, 99730, 108340, 117610, 127590, 138320, 149840, 162200, 175450, 189640, 204820, 221040, 238370,
                    ],
                },
                Cs: {
                    name: "Cesium",
                    atomicNumber: 55,
                    color: "#57178F", // Dark purple
                    shellConfiguration: [2, 8, 18, 18, 8, 1],
                    shellIonizationEnergies: {
                        0: [1071400, 1171000], // Inner shell (1s)
                        1: [169800, 192300, 217100, 244700, 275300, 309100, 346400, 387600], // Second shell (2s, 2p)
                        2: [54400, 58800, 63800, 69300, 75400, 82100, 89500, 97600, 106400, 116000, 126400, 137700, 149900, 163100, 177400, 192900, 209700, 227900], // Third shell (3s, 3p, 3d)
                        3: [11200, 12300, 13500, 14800, 16300, 17900, 19700, 21700, 23900, 26300, 28900, 31800, 35000, 38500, 42300, 46400, 50900, 55800], // Fourth shell (4s, 4p, 4d)
                        4: [2234, 4355, 6273, 8781, 12800, 14900, 17500, 20600], // Fifth shell (5s, 5p)
                        5: [376], // Outer shell (6s)
                    },
                    sequentialIonizationEnergies: [
                        376, 2234, 3170, 4355, 5210, 6273, 7238, 8781, 9900, 23400, 25600, 28100, 30900, 34000, 37400, 41100, 45100, 49500, 54300, 59500, 65100, 71100, 77500, 84300, 91600, 99400, 107700, 116500, 125800, 135700, 146100, 157100, 168700, 180900, 193700, 207100, 221100, 235800, 251200, 267300, 284200, 301900, 320400, 339800, 360100, 381300, 403500, 426700, 450900, 476200, 502600, 530100, 558800, 588700, 619800,
                    ],
                },
                K: {
                    name: "Potassium",
                    atomicNumber: 19,
                    color: "#8F40D4", // Purple
                    shellConfiguration: [2, 8, 8, 1],
                    shellIonizationEnergies: {
                        0: [354600, 387600], // Inner shell (1s)
                        1: [37700, 44900, 53500, 62300, 72100, 82700, 96300, 106800], // Second shell (2s, 2p)
                        2: [4610, 6300, 8400, 11200, 14700, 18800, 23300, 27700], // Third shell (3s, 3p)
                        3: [419], // Outer shell (4s)
                    },
                    sequentialIonizationEnergies: [
                        419, 3052, 4420, 5877, 7975, 9590, 11343, 14944, 16963, 48610, 54490, 60730, 68950, 75900, 83800, 93400, 99710, 444900,
                    ],
                },
                Ca: {
                    name: "Calcium",
                    atomicNumber: 20,
                    color: "#3DFF00", // Bright lime
                    shellConfiguration: [2, 8, 8, 2],
                    shellIonizationEnergies: {
                        0: [384400, 418300], // Inner shell (1s)
                        1: [40800, 48500, 57600, 67000, 77200, 88400, 102000, 113000], // Second shell (2s, 2p)
                        2: [5470, 7200, 9500, 12300, 15900, 20100, 24800, 29700], // Third shell (3s, 3p)
                        3: [590, 1145], // Outer shell (4s)
                    },
                    sequentialIonizationEnergies: [
                        590, 1145, 4912, 6474, 8144, 10496, 12270, 14206, 18191, 20385, 57110, 63410, 70110, 78890, 86310, 94700, 104900, 111711, 494850,
                    ],
                },
            };

            // Function to get shell name by index
            const getShellName = (shellIndex, totalShells) => {
                if (totalShells === 1) return "Inner Shell";
                if (totalShells === 2) {
                    return shellIndex === 0 ? "Inner Shell" : "Outer Shell";
                }
                if (shellIndex === 0) return "Inner Shell";
                if (shellIndex === totalShells - 1) return "Outer Shell";
                return "Middle Shell";
            };

            // Calculate total electrons in the selected element
            const getTotalElectrons = () => {
                if (!selectedElement) return 0;
                return elements[selectedElement].shellConfiguration.reduce(
                    (sum, count) => sum + count,
                    0
                );
            };

            // Calculate energy meter height percentage with a minimum visible height
            const getEnergyMeterHeight = (value) => {
                if (value <= 0) return 0;
                const percentage = (value / maxEnergy) * 100;
                return Math.max(10, percentage);
            };

            // Determine ionization energy based on shell and number of electrons already removed from that shell
            const getIonizationEnergy = (shellIndex, electronIndexInShell) => {
                if (!selectedElement) return 0;

                const shellConfig = elements[selectedElement].shellConfiguration;
                const shellEnergies = elements[selectedElement].shellIonizationEnergies;

                const removedFromShell = ionizationDetails.filter(
                    (detail) => detail.shell === shellIndex && detail.element === selectedElement
                ).length;

                if (shellEnergies[shellIndex] && shellEnergies[shellIndex][removedFromShell]) {
                    return shellEnergies[shellIndex][removedFromShell];
                }

                return Math.max(...elements[selectedElement].sequentialIonizationEnergies) * 1.2;
            };

            // Reset simulation
            const resetSimulation = () => {
                setActiveDragIndex(null);
                setDragPosition({ x: 0, y: 0 });
                setDragStartPosition({ x: 0, y: 0 });
                setEnergyValue(0);
                setResetKey((prev) => prev + 1);
                setCompletedIonizations([]);
                setIsDragging(false);
                setCurrentDraggedShell(null);

                if (selectedElement) {
                    const newShellElectronCounts = {};
                    elements[selectedElement].shellConfiguration.forEach((count, index) => {
                        newShellElectronCounts[index] = count;
                    });
                    setShellElectronCounts(newShellElectronCounts);
                }

                if (animationFrameRef.current) {
                    cancelAnimationFrame(animationFrameRef.current);
                }
            };

            // Handle element selection
            const handleElementSelect = (element) => {
                setSelectedElement(element);
                setActiveDragIndex(null);
                setDragPosition({ x: 0, y: 0 });
                setDragStartPosition({ x: 0, y: 0 });
                setEnergyValue(0);
                setCompletedIonizations([]);
                setIsDragging(false);
                setCurrentDraggedShell(null);

                const newShellElectronCounts = {};
                elements[element].shellConfiguration.forEach((count, index) => {
                    newShellElectronCounts[index] = count;
                });
                setShellElectronCounts(newShellElectronCounts);

                setResetKey((prev) => prev + 1);

                // Update max energy to accommodate all previous ionizations plus this element
                const allEnergies = [
                    ...ionizationDetails.map(d => d.energy),
                    elements[element].sequentialIonizationEnergies[0]
                ];
                const maxEnergyFromAll = Math.max(...allEnergies);
                setMaxEnergy(maxEnergyFromAll * 1.5);
            };

            // Toggle whether inner shell electrons can be removed
            const toggleInnerShellRemoval = () => {
                setAllowInnerShellRemoval(!allowInnerShellRemoval);
                resetSimulation();
            };

            // Update electron positions based on current state
            const updateElectronPositions = () => {
                if (!selectedElement) return;

                const newElectrons = [];
                const shellConfig = elements[selectedElement].shellConfiguration;
                const centerX = 200;
                const centerY = 200;

                for (let shellIndex = 0; shellIndex < shellConfig.length; shellIndex++) {
                    const originalElectronCount = shellConfig[shellIndex];
                    const currentElectronCount = shellElectronCounts[shellIndex] || 0;
                    const shellRadius = 50 + shellIndex * 40;

                    for (let i = 0; i < currentElectronCount; i++) {
                        const angle = (i / originalElectronCount) * 2 * Math.PI;
                        const x = centerX + shellRadius * Math.cos(angle);
                        const y = centerY + shellRadius * Math.sin(angle);

                        newElectrons.push({
                            id: `${shellIndex}-${i}`,
                            x,
                            y,
                            shellIndex,
                            electronIndex: i,
                            radius: 8,
                            energy: getIonizationEnergy(shellIndex, i),
                        });
                    }
                }

                setElectrons(newElectrons);
            };

            // Handle canvas mouse down - check if an electron was clicked
            const handleCanvasMouseDown = (event) => {
                if (isDragging || !selectedElement) return;

                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                const mouseX = event.clientX - rect.left;
                const mouseY = event.clientY - rect.top;

                for (const electron of electrons) {
                    const dx = mouseX - electron.x;
                    const dy = mouseY - electron.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance <= electron.radius) {
                        startDrag(
                            electron.shellIndex,
                            electron.electronIndex,
                            electron.x,
                            electron.y,
                            electron.energy
                        );
                        break;
                    }
                }
            };

            // Start dragging an electron
            const startDrag = (shellIndex, electronIndex, startX, startY, energy) => {
                if (!selectedElement) return;

                if (!allowInnerShellRemoval) {
                    const shellConfig = elements[selectedElement].shellConfiguration;
                    const lastShellIndex = shellConfig.length - 1;

                    if (shellIndex !== lastShellIndex && shellElectronCounts[lastShellIndex] > 0) {
                        return;
                    }
                }

                setIsDragging(true);
                setActiveDragIndex(`${shellIndex}-${electronIndex}`);
                setDragStartPosition({ x: startX, y: startY });
                setDragPosition({ x: startX, y: startY });

                const totalShells = elements[selectedElement].shellConfiguration.length;
                const shellName = getShellName(shellIndex, totalShells);
                setCurrentDraggedShell(shellName);

                setEnergyValue(0);
            };

            // Continue dragging
            const handleMouseMove = (event) => {
                if (!isDragging || activeDragIndex === null || !selectedElement) return;

                const canvas = canvasRef.current;
                if (!canvas) return;

                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;

                setDragPosition({ x, y });

                const dx = x - dragStartPosition.x;
                const dy = y - dragStartPosition.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                const [shellIndex, electronIndex] = activeDragIndex.split("-").map(Number);
                const targetEnergy = getIonizationEnergy(shellIndex, electronIndex);

                const shellConfig = elements[selectedElement].shellConfiguration;
                const totalShells = shellConfig.length;

                const shellDistanceScale = 1 + (totalShells - shellIndex - 1) * 0.75;
                const maxDistance = 150 * shellDistanceScale;

                let energyLevel = 0;
                if (distance < maxDistance) {
                    const normalizedDistance = distance / maxDistance;
                    energyLevel = targetEnergy * Math.pow(normalizedDistance, 1.5);
                } else {
                    energyLevel = targetEnergy;
                }

                setEnergyValue(Math.min(energyLevel, targetEnergy));

                const ionizationThreshold = 180 * shellDistanceScale;
                if (distance > ionizationThreshold) {
                    completeIonization(targetEnergy);
                }
            };

            // End dragging
            const handleMouseUp = () => {
                if (!isDragging || !selectedElement) return;

                const [shellIndex, electronIndex] = activeDragIndex.split("-").map(Number);
                const targetEnergy = getIonizationEnergy(shellIndex, electronIndex);

                if (energyValue < targetEnergy * 0.8) {
                    animateElectronReturn();
                } else {
                    completeIonization(targetEnergy);
                }
            };

            // Animate electron returning to its position
            const animateElectronReturn = () => {
                const startTime = performance.now();
                const startX = dragPosition.x;
                const startY = dragPosition.y;
                const endX = dragStartPosition.x;
                const endY = dragStartPosition.y;
                const duration = 500;

                const animate = (currentTime) => {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);

                    const easeProgress = 1 - Math.pow(1 - progress, 3);

                    const x = startX + (endX - startX) * easeProgress;
                    const y = startY + (endY - startY) * easeProgress;

                    setDragPosition({ x, y });
                    setEnergyValue(energyValue * (1 - easeProgress));

                    if (progress < 1) {
                        animationFrameRef.current = requestAnimationFrame(animate);
                    } else {
                        setActiveDragIndex(null);
                        setIsDragging(false);
                        setEnergyValue(0);
                        setCurrentDraggedShell(null);
                    }
                };

                animationFrameRef.current = requestAnimationFrame(animate);
            };

            // Complete ionization process
            const completeIonization = (actualEnergy) => {
                if (activeDragIndex === null || !selectedElement) return;

                const [shellIndex, electronIndex] = activeDragIndex.split("-").map(Number);

                const totalShells = elements[selectedElement].shellConfiguration.length;
                const shellName = getShellName(shellIndex, totalShells);

                const removedFromShell = ionizationDetails.filter(
                    (detail) => detail.shell === shellIndex && detail.element === selectedElement
                ).length;

                const newShellElectronCounts = { ...shellElectronCounts };
                newShellElectronCounts[shellIndex] = (newShellElectronCounts[shellIndex] || 0) - 1;
                setShellElectronCounts(newShellElectronCounts);

                setCompletedIonizations([...completedIonizations, activeDragIndex]);

                const newDetail = {
                    electron: activeDragIndex,
                    shell: shellIndex,
                    shellName,
                    electronNumber: electronIndex + 1,
                    removeNumber: removedFromShell + 1,
                    energy: actualEnergy,
                    element: selectedElement,
                };

                const newIonizationDetails = [...ionizationDetails, newDetail];
                setIonizationDetails(newIonizationDetails);

                setEnergyValue(actualEnergy);

                const allEnergies = [...ionizationDetails.map((d) => d.energy), actualEnergy];

                const shellsWithIonizations = new Set([
                    ...ionizationDetails.map((d) => d.shellName),
                    shellName,
                ]);

                let newMaxEnergy;

                if (shellsWithIonizations.has("Inner Shell")) {
                    const innerShellEnergies = [
                        ...ionizationDetails
                            .filter((d) => d.shellName === "Inner Shell")
                            .map((d) => d.energy),
                        shellName === "Inner Shell" ? actualEnergy : 0,
                    ].filter((e) => e > 0);

                    if (innerShellEnergies.length > 0) {
                        newMaxEnergy = Math.max(...innerShellEnergies) * 1.2;
                    } else {
                        newMaxEnergy = Math.max(...allEnergies) * 1.5;
                    }
                } else if (shellsWithIonizations.has("Middle Shell")) {
                    const middleShellEnergies = [
                        ...ionizationDetails
                            .filter((d) => d.shellName === "Middle Shell")
                            .map((d) => d.energy),
                        shellName === "Middle Shell" ? actualEnergy : 0,
                    ].filter((e) => e > 0);

                    if (middleShellEnergies.length > 0) {
                        newMaxEnergy = Math.max(...middleShellEnergies) * 1.5;
                    } else {
                        newMaxEnergy = Math.max(...allEnergies) * 1.5;
                    }
                } else {
                    newMaxEnergy = Math.max(...allEnergies) * 2;
                }

                setMaxEnergy(newMaxEnergy);

                setActiveDragIndex(null);
                setIsDragging(false);
                setCurrentDraggedShell(null);

                updateElectronPositions();
            };

            // Effects
            useEffect(() => {
                updateElectronPositions();
            }, [selectedElement, shellElectronCounts, resetKey]);

            useEffect(() => {
                updateElectronPositions();
            }, [selectedElement]);

            // Canvas drawing effect
            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas || !selectedElement) return;

                const ctx = canvas.getContext("2d");
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const nucleusRadius = 20;

                // Draw nucleus
                ctx.beginPath();
                ctx.arc(centerX, centerY, nucleusRadius, 0, 2 * Math.PI);
                ctx.fillStyle = "#000000"; // Black nucleus for all elements
                ctx.fill();

                // Draw element symbol in nucleus
                ctx.fillStyle = "white";
                ctx.font = "16px Poppins";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillText(selectedElement, centerX, centerY);

                // Draw electron shells
                const shellConfig = elements[selectedElement].shellConfiguration;

                shellConfig.forEach((electronCount, shellIndex) => {
                    const shellRadius = 50 + shellIndex * 40;

                    // Draw shell circle
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, shellRadius, 0, 2 * Math.PI);
                    ctx.strokeStyle = "#aaaaaa";
                    ctx.lineWidth = 1;
                    ctx.stroke();

                    // Add electron count
                    const currentCount = shellElectronCounts[shellIndex] || 0;
                    if (currentCount > 0) {
                        ctx.fillStyle = "rgba(0,0,0,0.5)";
                        ctx.font = "9px Poppins";
                        ctx.fillText(
                            `${currentCount}e⁻`,
                            centerX - shellRadius + 10,
                            centerY + 15
                        );
                    }
                });

                // Draw electrons
                electrons.forEach((electron) => {
                    if (electron.id === activeDragIndex) return;

                    ctx.beginPath();
                    ctx.arc(electron.x, electron.y, electron.radius, 0, 2 * Math.PI);
                    ctx.fillStyle = "#3498db";
                    ctx.fill();

                    ctx.fillStyle = "white";
                    ctx.font = "9px Poppins";
                    ctx.fillText("e⁻", electron.x, electron.y);
                });

                // Draw dragged electron if any
                if (isDragging && activeDragIndex !== null) {
                    const x = dragPosition.x;
                    const y = dragPosition.y;

                    // Draw electron
                    ctx.beginPath();
                    ctx.arc(x, y, 8, 0, 2 * Math.PI);
                    ctx.fillStyle = "#000000";
                    ctx.fill();

                    // Draw force line
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(x, y);
                    ctx.strokeStyle = "#e74c3c";
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    // Draw electron label
                    ctx.fillStyle = "white";
                    ctx.font = "9px Poppins";
                    ctx.fillText("e⁻", x, y);
                }
            }, [
                electrons,
                activeDragIndex,
                dragPosition,
                isDragging,
                shellElectronCounts,
                selectedElement,
            ]);

            // Mouse event listeners
            useEffect(() => {
                const handleGlobalMouseMove = (event) => {
                    handleMouseMove(event);
                };

                const handleGlobalMouseUp = () => {
                    handleMouseUp();
                };

                if (isDragging) {
                    window.addEventListener("mousemove", handleGlobalMouseMove);
                    window.addEventListener("mouseup", handleGlobalMouseUp);
                }

                return () => {
                    window.removeEventListener("mousemove", handleGlobalMouseMove);
                    window.removeEventListener("mouseup", handleGlobalMouseUp);
                };
            }, [isDragging, activeDragIndex, energyValue, dragStartPosition]);

            // Initialize with Lithium
            useEffect(() => {
                handleElementSelect("Li");
            }, []);

            // Cleanup
            useEffect(() => {
                return () => {
                    if (animationFrameRef.current) {
                        cancelAnimationFrame(animationFrameRef.current);
                    }
                };
            }, []);

            // Don't render until element is selected
            if (!selectedElement) {
                return React.createElement('div', null, 'Loading...');
            }

            return React.createElement('div', {
                style: {
                    fontFamily: "Poppins, sans-serif",
                    fontWeight: 400,
                    padding: "20px",
                    maxWidth: "1000px",
                    margin: "0 auto",
                }
            }, [
               
                React.createElement('p', {
                    key: 'description',
                    style: { marginBottom: "15px" }
                }, 'Drag electrons away from the atom to see how much energy is required to remove them.'),

                // Element selector
                React.createElement('div', {
                    key: 'element-selector',
                    style: { marginBottom: "20px" }
                }, [
                    React.createElement('h2', {
                        key: 'selector-title',
                        style: { fontSize: "18px", fontWeight: 600, marginBottom: "10px" }
                    }, 'Select Element:'),
                    
                    React.createElement('div', {
                        key: 'element-buttons',
                        style: {
                            display: "flex",
                            gap: "10px",
                            flexWrap: "wrap",
                            marginBottom: "10px",
                        }
                    }, Object.keys(elements).map((element) =>
                        React.createElement('button', {
                            key: element,
                            style: {
                                padding: "6px 12px",
                                borderRadius: "4px",
                                border: "none",
                                cursor: "pointer",
                                backgroundColor: selectedElement === element ? "#3498db" : "#f0f0f0",
                                color: selectedElement === element ? "white" : "black",
                                fontFamily: "'Poppins', sans-serif",
                                fontWeight: 600,
                                fontSize: "12px",
                            },
                            onClick: () => handleElementSelect(element)
                        }, `${element} - ${elements[element].name}`)
                    )),

                    // Inner shell removal toggle
                    React.createElement('div', {
                        key: 'toggle-container'
                    }, 
                        React.createElement('label', {
                            style: { display: "flex", alignItems: "center", cursor: "pointer" }
                        }, [
                            React.createElement('input', {
                                key: 'checkbox',
                                type: "checkbox",
                                checked: allowInnerShellRemoval,
                                onChange: toggleInnerShellRemoval,
                                style: { marginRight: "8px" }
                            }),
                            'Allow inner shell electron removal'
                        ])
                    )
                ]),

                // Main simulation container
                React.createElement('div', {
                    key: 'main-container',
                    style: {
                        border: "1px solid #e0e0e0",
                        borderRadius: "8px",
                        padding: "20px",
                        backgroundColor: "#f9f9f9",
                        display: "flex",
                        flexDirection: "column",
                    }
                }, [
                    React.createElement('h2', {
                        key: 'element-title',
                        style: { fontSize: "18px", fontWeight: "bold", marginBottom: "10px" }
                    }, `${elements[selectedElement].name} (${selectedElement})`),
                    
                    React.createElement('p', {
                        key: 'element-info',
                        style: { fontSize: "14px", marginBottom: "10px" }
                    }, `Atomic Number: ${elements[selectedElement].atomicNumber} | Electrons: ${Object.values(shellElectronCounts).reduce((sum, count) => sum + count, 0)} | Ionizations: ${completedIonizations.length}`),

                    React.createElement('div', {
                        key: 'simulation-area',
                        style: {
                            position: "relative",
                            display: "flex",
                            flexDirection: "column",
                            gap: "20px",
                            width: "100%",
                        }
                    }, [
                        // Top row with atom and current energy bar
                        React.createElement('div', {
                            key: 'top-row',
                            style: {
                                display: "flex",
                                alignItems: "flex-start",
                                gap: "20px",
                            }
                        }, [
                            // Atom canvas
                            React.createElement('div', {
                                key: 'canvas-container'
                            }, [
                                React.createElement('canvas', {
                                    key: 'canvas',
                                    ref: canvasRef,
                                    width: "400",
                                    height: "400",
                                    style: {
                                        border: "1px solid #e0e0e0",
                                        borderRadius: "4px",
                                        backgroundColor: "white",
                                        cursor: "pointer",
                                    },
                                    onMouseDown: handleCanvasMouseDown
                                }),

                                // Instructions
                                React.createElement('div', {
                                    key: 'instructions',
                                    style: {
                                        position: "absolute",
                                        top: "10px",
                                        left: "10px",
                                        backgroundColor: "rgba(255, 255, 255, 0.7)",
                                        padding: "8px",
                                        borderRadius: "4px",
                                        fontSize: "12.5px",
                                    }
                                }, 'Click and drag an electron away from the atom to ionize it.')
                            ]),

                            // Current energy meter
                            React.createElement('div', {
                                key: 'energy-meter',
                                style: {
                                    display: "flex",
                                    flexDirection: "column",
                                    alignItems: "center",
                                }
                            }, [
                                React.createElement('div', {
                                    key: 'energy-title',
                                    style: {
                                        fontSize: "14px",
                                        fontWeight: "500",
                                        marginBottom: "8px",
                                    }
                                }, 'Current Energy'),

                                energyValue > 0 && React.createElement('div', {
                                    key: 'energy-value',
                                    style: {
                                        marginBottom: "8px",
                                        padding: "4px 8px",
                                        borderRadius: "4px",
                                        border: "1px solid #e0e0e0",
                                        minWidth: "80px",
                                        textAlign: "center",
                                        background: currentDraggedShell
                                            ? `linear-gradient(to right, ${shellColors[currentDraggedShell][0]}, ${shellColors[currentDraggedShell][1]})`
                                            : "linear-gradient(to right, #ff9800, #ffcc80)",
                                    }
                                }, 
                                    React.createElement('span', {
                                        style: {
                                            fontSize: "12px",
                                            fontWeight: "bold",
                                            color: "white",
                                        }
                                    }, `${Math.round(energyValue)} kJ/mol`)
                                ),

                                React.createElement('div', {
                                    key: 'energy-meter-bar',
                                    style: {
                                        width: "64px",
                                        height: "256px",
                                        border: "1px solid #e0e0e0",
                                        borderRadius: "4px",
                                        background: "linear-gradient(to top, #f0f8ff, #fff0f0)",
                                        position: "relative",
                                        overflow: "hidden",
                                    }
                                }, [
                                    React.createElement('div', {
                                        key: 'meter-labels',
                                        style: {
                                            position: "absolute",
                                            inset: "0",
                                            display: "flex",
                                            flexDirection: "column",
                                            justifyContent: "space-between",
                                            pointerEvents: "none",
                                            padding: "4px",
                                        }
                                    }, [
                                        React.createElement('span', {
                                            key: 'high-label',
                                            style: { fontSize: "12px", color: "#666" }
                                        }, 'high'),
                                        React.createElement('span', {
                                            key: 'low-label',
                                            style: { fontSize: "12px", color: "#666" }
                                        }, 'low')
                                    ]),

                                    React.createElement('div', {
                                        key: 'meter-fill',
                                        style: {
                                            position: "absolute",
                                            bottom: "0",
                                            left: "0",
                                            right: "0",
                                            background: currentDraggedShell
                                                ? `linear-gradient(to top, ${shellColors[currentDraggedShell][0]}, ${shellColors[currentDraggedShell][1]})`
                                                : "linear-gradient(to top, #ff9800, #ffcc80)",
                                            transition: "height 0.1s",
                                            height: `${getEnergyMeterHeight(energyValue)}%`,
                                            maxHeight: "100%",
                                        }
                                    })
                                ])
                            ])
                        ]),

                        // Bottom row with ionization energy bars
                        React.createElement('div', {
                            key: 'bottom-row',
                            style: {
                                display: "flex",
                                flexDirection: "column",
                                alignItems: "center",
                                width: "100%",
                                marginTop: "60px",
                            }
                        }, [
                            // Clear All button
                            ionizationDetails.length > 0 && React.createElement('button', {
                                key: 'clear-all-btn',
                                style: {
                                    padding: "10px",
                                    backgroundColor: "#e74c3c",
                                    color: "white",
                                    border: "none",
                                    borderRadius: "4px",
                                    cursor: "pointer",
                                    marginBottom: "10px",
                                    fontSize: "12px",
                                },
                                onClick: () => setIonizationDetails([])
                            }, 'Clear All Comparisons'),

                            React.createElement('div', {
                                style: {
                                    display: "flex",
                                    gap: "32px",
                                    alignItems: "left",
                                    height: "450px",
                                    justifyContent: "left",
                                    margin: "0 auto",
                                    width: "fit-content",
                                    flexWrap: "wrap",
                                    maxWidth: "800px",
                                }
                            }, ionizationDetails.slice(-8).map((detail, idx) => {
                                const ionizationEnergy = detail.energy;
                                const shellColor = shellColors[detail.shellName] || ["#9e9e9e", "#bdbdbd"];
                                const heightPercentage = getEnergyMeterHeight(ionizationEnergy);

                                return React.createElement('div', {
                                    key: `ie-${idx}`,
                                    style: {
                                        display: "flex",
                                        flexDirection: "column",
                                        alignItems: "center",
                                    }
                                }, [
                                    // Energy value at the top
                                    React.createElement('div', {
                                        key: 'energy-val',
                                        style: {
                                            marginBottom: "8px",
                                            padding: "4px 8px",
                                            borderRadius: "4px",
                                            border: "1px solid #e0e0e0",
                                            minWidth: "64px",
                                            textAlign: "center",
                                            background: `linear-gradient(to right, ${shellColor[0]}, ${shellColor[1]})`,
                                        }
                                    }, 
                                        React.createElement('span', {
                                            style: {
                                                fontSize: "12px",
                                                fontWeight: "bold",
                                                color: "white",
                                            }
                                        }, `${Math.round(ionizationEnergy)} kJ/mol`)
                                    ),

                                    React.createElement('div', {
                                        key: 'bar-container',
                                        style: {
                                            width: "64px",
                                            height: "256px",
                                            border: "1px solid #e0e0e0",
                                            borderRadius: "4px",
                                            backgroundColor: "#f9f9f9",
                                            position: "relative",
                                            overflow: "hidden",
                                        }
                                    }, 
                                        React.createElement('div', {
                                            style: {
                                                position: "absolute",
                                                bottom: "0",
                                                left: "0",
                                                right: "0",
                                                background: `linear-gradient(to top, ${shellColor[0]}, ${shellColor[1]})`,
                                                height: `${heightPercentage}%`,
                                                maxHeight: "100%",
                                            }
                                        })
                                    ),
                                    
                                    React.createElement('div', {
                                        key: 'shell-name',
                                        style: {
                                            fontSize: "13px",
                                            fontWeight: "500",
                                            marginTop: "6px",
                                        }
                                    }, detail.shellName),

                                    React.createElement('div', {
                                        key: 'element-name',
                                        style: {
                                            fontSize: "12px",
                                            fontWeight: "600",
                                            marginTop: "2px",
                                            color: elements[detail.element]?.color || "#333",
                                        }
                                    }, detail.element)
                                ]);
                            }))
                        ])
                    ]),

                    React.createElement('div', {
                        key: 'reset-button-container',
                        style: {
                            display: "flex",
                            justifyContent: "center",
                            marginTop: "20px",
                        }
                    }, 
                        React.createElement('button', {
                            style: {
                                padding: "8px 16px",
                                backgroundColor: "#3498db",
                                color: "white",
                                border: "none",
                                borderRadius: "4px",
                                cursor: "pointer",
                            },
                            onClick: resetSimulation
                        }, 'Reset Current Element')
                    )
                ]),

                // Ionization energy values
                React.createElement('div', {
                    key: 'ionization-details',
                    style: {
                        marginTop: "16px",
                        border: "1px solid #e0e0e0",
                        borderRadius: "8px",
                        padding: "20px",
                        backgroundColor: "#f9f9f9",
                    }
                }, 
                    React.createElement('div', {
                        style: {
                            display: "grid",
                            gridTemplateColumns: "repeat(auto-fill, minmax(180px, 1fr))",
                            gap: "8px",
                        }
                    }, ionizationDetails.map((detail, idx) => {
                        const shellColor = shellColors[detail.shellName] || ["#9e9e9e", "#bdbdbd"];

                        return React.createElement('div', {
                            key: `ie-detail-${idx}`,
                            style: {
                                padding: "8px",
                                borderRadius: "4px",
                                border: `2px solid ${shellColor[0]}`,
                                backgroundColor: "#f5f5f5",
                            }
                        }, [
                            React.createElement('div', {
                                key: 'element-header',
                                style: {
                                    display: "flex",
                                    justifyContent: "space-between",
                                    alignItems: "center",
                                    marginBottom: "4px",
                                }
                            }, [
                                React.createElement('span', {
                                    key: 'shell-name',
                                    style: {
                                        fontWeight: "500",
                                        fontSize: "14px",
                                        color: shellColor[0],
                                    }
                                }, detail.shellName),
                                
                                React.createElement('span', {
                                    key: 'element-symbol',
                                    style: {
                                        fontWeight: "600",
                                        fontSize: "13px",
                                        color: elements[detail.element]?.color || "#333",
                                        backgroundColor: "rgba(255,255,255,0.8)",
                                        padding: "2px 6px",
                                        borderRadius: "3px",
                                    }
                                }, detail.element)
                            ]),
                            
                            React.createElement('div', {
                                key: 'electron-info',
                                style: { fontSize: "13px" }
                            }, `Electron #${detail.removeNumber} from shell`),
                            
                            React.createElement('div', {
                                key: 'energy-info',
                                style: {
                                    fontSize: "13px",
                                    marginTop: "2px",
                                    fontWeight: "500",
                                }
                            }, `${detail.energy} kJ/mol`)
                        ]);
                    }))
                )
            ]);
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
